From news@gmane.org Tue Mar 04 03:33:20 2003
From: Matthias Urlichs <smurf@smurf.noris.de>
Subject: [PATCH] Improve usage messages
Date: Thu, 21 Apr 2005 22:41:52 +1000 (EST)
Lines: 82
Message-ID: <20050421124152.A28137F87D@smurf.noris.de>
X-From: git-owner@vger.kernel.org Thu Apr 21 14:50:19 2005
Return-path: <git-owner@vger.kernel.org>
Received: from vger.kernel.org ([12.107.209.244])
	by ciao.gmane.org with esmtp (Exim 4.43)
	id 1DOb7r-0002HV-9F
	for gcvg-git@gmane.org; Thu, 21 Apr 2005 14:49:47 +0200
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261344AbVDUMyK (ORCPT <rfc822;gcvg-git@m.gmane.org>);
	Thu, 21 Apr 2005 08:54:10 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261342AbVDUMyK
	(ORCPT <rfc822;git-outgoing>); Thu, 21 Apr 2005 08:54:10 -0400
Received: from run.smurf.noris.de ([192.109.102.41]:7647 "EHLO
	server.smurf.noris.de") by vger.kernel.org with ESMTP
	id S261345AbVDUMxk (ORCPT <rfc822;git@vger.kernel.org>);
	Thu, 21 Apr 2005 08:53:40 -0400
Received: from kiste.smurf.noris.de ([192.109.102.35] ident=mail)
	by server.smurf.noris.de with smtp (Exim 4.50)
	id 1DObAx-0004vP-RC
	for git@vger.kernel.org; Thu, 21 Apr 2005 14:53:05 +0200
Received: (nullmailer pid 1126 invoked by uid 501);
	Thu, 21 Apr 2005 12:52:59 -0000
Received: from [150.203.247.5] (helo=smurf.noris.de)
	by server.smurf.noris.de with esmtp (Exim 4.50)
	id 1DOb6J-0004ly-1J
	for smurf@smurf.noris.de; Thu, 21 Apr 2005 14:48:23 +0200
Received: by smurf.noris.de (Postfix, from userid 501)
	id A28137F87D; Thu, 21 Apr 2005 22:41:52 +1000 (EST)
To: git@vger.kernel.org
X-Smurf-Spam-Score: -1.2 (-)
X-Smurf-Spam-Score: -1.5 (-)
X-Smurf-Whitelist: +relay_from_hosts
Sender: git-owner@vger.kernel.org
Precedence: bulk
X-Mailing-List: git@vger.kernel.org
Status: RO

This patch adds somewhat-improved usage messages to some of Linus' programs.
Specifically, they now handle -? / --help.

Signed-Off-By: Matthias Urlichs <smurf@smurf.noris.de>

Index: check-files.c
===================================================================
--- 42a073eb6b5bb397a3e8768a032463a7fa02e6b9/check-files.c  (mode:100644 sha1:7d16691aa9d51b5b4670d5837b3527ee7c7da79c)
+++ 265515f9c4f089b1b61e9d2312c4b3babe189618/check-files.c  (mode:100644 sha1:be904b13659a60eab31787b010a64f2274048a9f)
@@ -40,6 +40,8 @@
 {
 	int i;
 
+	if(argc == 2 && (!strcmp(argv[1],"-?") || !strcmp(argv[1],"--help")))
+		usage("check-files filename...");
 	read_cache();
 	for (i = 1; i < argc ; i++)
 		check_file(argv[i]);
Index: diff-tree.c
===================================================================
--- 42a073eb6b5bb397a3e8768a032463a7fa02e6b9/diff-tree.c  (mode:100644 sha1:b0122e42631410fa579115f025efc3cab777cde6)
+++ 265515f9c4f089b1b61e9d2312c4b3babe189618/diff-tree.c  (mode:100644 sha1:03fcc2fae2f0b06f3834f0b6e0d8762e70f49f51)
@@ -193,6 +193,11 @@
 	}
 }
 
+static const char diff_tree_usage[] = 
+	"diff-tree [ -r (recurse) | -z (\\0-terminate) ]"
+		"\n\t<tree sha1> <tree sha1>";
+
+
 int main(int argc, char **argv)
 {
 	unsigned char old[20], new[20];
@@ -209,11 +214,11 @@
 			line_termination = '\0';
 			continue;
 		}
-		usage("diff-tree [-r] [-z] <tree sha1> <tree sha1>");
+		usage(diff_tree_usage);
 	}
 
 	if (argc != 3 || get_sha1_hex(argv[1], old) || get_sha1_hex(argv[2], new))
-		usage("diff-tree [-r] [-z] <tree sha1> <tree sha1>");
+		usage(diff_tree_usage);
 	commit_to_tree(old);
 	commit_to_tree(new);
 	return diff_tree_sha1(old, new, "");
--- 42a073eb6b5bb397a3e8768a032463a7fa02e6b9/init-db.c  (mode:100644 sha1:dad06351ca35d0d2f68cd9e719c49805386f96fa)
+++ 265515f9c4f089b1b61e9d2312c4b3babe189618/init-db.c  (mode:100644 sha1:4afd436e719b347cdf6b4420c9d926e453f1f95b)
@@ -26,6 +26,9 @@
 	char *sha1_dir, *path;
 	int len, i;
 
+	if(argc != 1)
+		usage("init-db");
+
 	safe_create_dir(".git");
 
 	sha1_dir = getenv(DB_ENVIRONMENT);
--- 42a073eb6b5bb397a3e8768a032463a7fa02e6b9/write-tree.c  (mode:100644 sha1:827809dbddbff6dd8cf842641f6db5ad2f3ae07a)
+++ 265515f9c4f089b1b61e9d2312c4b3babe189618/write-tree.c  (mode:100644 sha1:55fe1c75c3065c8d5bef34f4f2e7af7aa147ea9d)
@@ -101,9 +101,13 @@
 int main(int argc, char **argv)
 {
 	int i, unmerged;
-	int entries = read_cache();
+	int entries;
 	unsigned char sha1[20];
 
+	if(argc != 1)
+		usage("write-tree");
+
+	entries = read_cache();
 	if (entries <= 0)
 		die("write-tree: no cache contents to write");
 
-
To unsubscribe from this list: send the line "unsubscribe git" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html



From news@gmane.org Tue Mar 04 03:33:20 2003
From: Matthias Urlichs <smurf@smurf.noris.de>
Subject: [PATCH] Missing quotes
Date: Thu, 21 Apr 2005 22:45:45 +1000 (EST)
Lines: 26
Message-ID: <20050421124545.AEED67F898@smurf.noris.de>
X-From: git-owner@vger.kernel.org Thu Apr 21 14:50:20 2005
Return-path: <git-owner@vger.kernel.org>
Received: from vger.kernel.org ([12.107.209.244])
	by ciao.gmane.org with esmtp (Exim 4.43)
	id 1DOb7W-0002ER-Nd
	for gcvg-git@gmane.org; Thu, 21 Apr 2005 14:49:27 +0200
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261347AbVDUMxr (ORCPT <rfc822;gcvg-git@m.gmane.org>);
	Thu, 21 Apr 2005 08:53:47 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261344AbVDUMxn
	(ORCPT <rfc822;git-outgoing>); Thu, 21 Apr 2005 08:53:43 -0400
Received: from run.smurf.noris.de ([192.109.102.41]:7647 "EHLO
	server.smurf.noris.de") by vger.kernel.org with ESMTP
	id S261342AbVDUMxi (ORCPT <rfc822;git@vger.kernel.org>);
	Thu, 21 Apr 2005 08:53:38 -0400
Received: from kiste.smurf.noris.de ([192.109.102.35] ident=mail)
	by server.smurf.noris.de with smtp (Exim 4.50)
	id 1DObBS-0004w6-RO
	for git@vger.kernel.org; Thu, 21 Apr 2005 14:53:37 +0200
Received: (nullmailer pid 1141 invoked by uid 501);
	Thu, 21 Apr 2005 12:53:30 -0000
Received: from [150.203.247.5] (helo=smurf.noris.de)
	by server.smurf.noris.de with esmtp (Exim 4.50)
	id 1DOb6J-0004m1-1M
	for smurf@smurf.noris.de; Thu, 21 Apr 2005 14:48:20 +0200
Received: by smurf.noris.de (Postfix, from userid 501)
	id AEED67F898; Thu, 21 Apr 2005 22:45:45 +1000 (EST)
To: git@vger.kernel.org
X-Smurf-Spam-Score: -0.8 (/)
X-Smurf-Spam-Score: -1.7 (-)
X-Smurf-Whitelist: +relay_from_hosts
Sender: git-owner@vger.kernel.org
Precedence: bulk
X-Mailing-List: git@vger.kernel.org
Status: RO

gitXnormid.sh should quote its cat-file calls so that nonexisting ssha1
IDs don't result in shell errors.

Signed-Off-By: Matthias Urlichs <smurf@smurf.noris.de>

--- 42a073eb6b5bb397a3e8768a032463a7fa02e6b9/gitXnormid.sh  (mode:100755 sha1:c0d53afabe8662ebfc3c697faf08b0a2b43c93f7)
+++ 265515f9c4f089b1b61e9d2312c4b3babe189618/gitXnormid.sh  (mode:100644 sha1:94710a7a2ab945f1fbd5350cb0de15171ae3f582)
@@ -41,11 +41,11 @@
 	exit 1
 fi
 
-if [ "$type" = "tree" ] && [ $(cat-file -t "$id") = "commit" ]; then
+if [ "$type" = "tree" ] && [ "$(cat-file -t "$id")" = "commit" ]; then
 	id=$(cat-file commit $id | egrep "$TREE" | cut -d ' ' -f 2)
 fi
 
-if [ $(cat-file -t "$id") != "$type" ]; then
+if [ "$(cat-file -t "$id")" != "$type" ]; then
 	echo "Invalid id: $id" >&2
 	exit 1
 fi
-
To unsubscribe from this list: send the line "unsubscribe git" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html



From news@gmane.org Tue Mar 04 03:33:20 2003
From: Matthias Urlichs <smurf@smurf.noris.de>
Subject: [PATCH] Missing linefeeds
Date: Thu, 21 Apr 2005 22:44:30 +1000 (EST)
Lines: 26
Message-ID: <20050421124430.ACDC77F894@smurf.noris.de>
X-From: git-owner@vger.kernel.org Thu Apr 21 14:50:34 2005
Return-path: <git-owner@vger.kernel.org>
Received: from vger.kernel.org ([12.107.209.244])
	by ciao.gmane.org with esmtp (Exim 4.43)
	id 1DOb7P-0002Dh-Ew
	for gcvg-git@gmane.org; Thu, 21 Apr 2005 14:49:19 +0200
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261340AbVDUMxj (ORCPT <rfc822;gcvg-git@m.gmane.org>);
	Thu, 21 Apr 2005 08:53:39 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261344AbVDUMxj
	(ORCPT <rfc822;git-outgoing>); Thu, 21 Apr 2005 08:53:39 -0400
Received: from run.smurf.noris.de ([192.109.102.41]:7647 "EHLO
	server.smurf.noris.de") by vger.kernel.org with ESMTP
	id S261340AbVDUMxi (ORCPT <rfc822;git@vger.kernel.org>);
	Thu, 21 Apr 2005 08:53:38 -0400
Received: from kiste.smurf.noris.de ([192.109.102.35] ident=mail)
	by server.smurf.noris.de with smtp (Exim 4.50)
	id 1DObBJ-0004vi-Da
	for git@vger.kernel.org; Thu, 21 Apr 2005 14:53:28 +0200
Received: (nullmailer pid 1136 invoked by uid 501);
	Thu, 21 Apr 2005 12:53:19 -0000
Received: from [150.203.247.5] (helo=smurf.noris.de)
	by server.smurf.noris.de with esmtp (Exim 4.50)
	id 1DOb6J-0004m0-1I
	for smurf@smurf.noris.de; Thu, 21 Apr 2005 14:48:20 +0200
Received: by smurf.noris.de (Postfix, from userid 501)
	id ACDC77F894; Thu, 21 Apr 2005 22:44:30 +1000 (EST)
To: git@vger.kernel.org
X-Smurf-Spam-Score: -1.0 (-)
X-Smurf-Spam-Score: -1.6 (-)
X-Smurf-Whitelist: +relay_from_hosts
Sender: git-owner@vger.kernel.org
Precedence: bulk
X-Mailing-List: git@vger.kernel.org
Status: RO

This patch fixes die() and error() to print linefeeds after the message.

Signed-Off-By: Matthias Urlichs <smurf@smurf.noris.de>

--- 42a073eb6b5bb397a3e8768a032463a7fa02e6b9/usage.c  (mode:100644 sha1:e774d2ef32726af0707d817cdb63fc8751ddc9d8)
+++ 265515f9c4f089b1b61e9d2312c4b3babe189618/usage.c  (mode:100644 sha1:21715d88b1a82aa06a3914e3f0e69fb1b61cc442)
@@ -26,6 +26,7 @@
 	va_start(params, err);
 	report("fatal: ", err, params);
 	va_end(params);
+	fputs("\n", stderr);
 	exit(1);
 }
 
@@ -36,5 +37,6 @@
 	va_start(params, err);
 	report("error: ", err, params);
 	va_end(params);
+	fputs("\n", stderr);
 	return -1;
 }
-
To unsubscribe from this list: send the line "unsubscribe git" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html



From news@gmane.org Tue Mar 04 03:33:20 2003
From: Matthias Urlichs <smurf@smurf.noris.de>
Subject: [PATCH] Add "git push"
Date: Thu, 21 Apr 2005 22:43:33 +1000 (EST)
Lines: 92
Message-ID: <20050421124333.AB2CE7F887@smurf.noris.de>
X-From: git-owner@vger.kernel.org Thu Apr 21 14:50:47 2005
Return-path: <git-owner@vger.kernel.org>
Received: from vger.kernel.org ([12.107.209.244])
	by ciao.gmane.org with esmtp (Exim 4.43)
	id 1DOb7f-0002G3-OV
	for gcvg-git@gmane.org; Thu, 21 Apr 2005 14:49:36 +0200
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261343AbVDUMx5 (ORCPT <rfc822;gcvg-git@m.gmane.org>);
	Thu, 21 Apr 2005 08:53:57 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261342AbVDUMx5
	(ORCPT <rfc822;git-outgoing>); Thu, 21 Apr 2005 08:53:57 -0400
Received: from run.smurf.noris.de ([192.109.102.41]:7647 "EHLO
	server.smurf.noris.de") by vger.kernel.org with ESMTP
	id S261343AbVDUMxj (ORCPT <rfc822;git@vger.kernel.org>);
	Thu, 21 Apr 2005 08:53:39 -0400
Received: from kiste.smurf.noris.de ([192.109.102.35] ident=mail)
	by server.smurf.noris.de with smtp (Exim 4.50)
	id 1DObB9-0004vZ-HS
	for git@vger.kernel.org; Thu, 21 Apr 2005 14:53:21 +0200
Received: (nullmailer pid 1131 invoked by uid 501);
	Thu, 21 Apr 2005 12:53:11 -0000
Received: from [150.203.247.5] (helo=smurf.noris.de)
	by server.smurf.noris.de with esmtp (Exim 4.50)
	id 1DOb6J-0004lz-1L
	for smurf@smurf.noris.de; Thu, 21 Apr 2005 14:48:24 +0200
Received: by smurf.noris.de (Postfix, from userid 501)
	id AB2CE7F887; Thu, 21 Apr 2005 22:43:33 +1000 (EST)
To: git@vger.kernel.org
X-Smurf-Spam-Score: -1.3 (-)
X-Smurf-Spam-Score: -1.6 (-)
X-Smurf-Whitelist: +relay_from_hosts
Sender: git-owner@vger.kernel.org
Precedence: bulk
X-Mailing-List: git@vger.kernel.org
Status: RO

This patch adds the ability to "git push", as the obvious converse of
"git pull".

Signed-Off-By: Matthias Urlichs <smurf@smurf.noris.de>

Index: git
===================================================================
--- 42a073eb6b5bb397a3e8768a032463a7fa02e6b9/git  (mode:100755 sha1:557122dfb05580e4af2c55767f3d6f92b9110edd)
+++ 265515f9c4f089b1b61e9d2312c4b3babe189618/git  (mode:100644 sha1:c32ee037c4dd68f8fa6723cb115644d46810bc89)
@@ -42,6 +42,7 @@
 	merge		[-c] [-b BASE_ID] FROM_ID
 	patch		[COMMIT_ID]
 	pull		[RNAME]
+	push		[RNAME]
 	rm		FILE...
 	seek		[COMMIT_ID]
 	status
@@ -86,6 +87,7 @@
 "lsremote")   gitlsremote.sh "$@";;
 "merge")      gitmerge.sh "$@";;
 "pull")       gitpull.sh "$@";;
+"push")       gitpush.sh "$@";;
 "patch")      gitpatch.sh "$@";;
 "rm")         gitrm.sh "$@";;
 "seek")       gitseek.sh "$@";;
--- /dev/null  (tree:42a073eb6b5bb397a3e8768a032463a7fa02e6b9)
+++ 265515f9c4f089b1b61e9d2312c4b3babe189618/gitpush.sh  (mode:100644 sha1:0a658141991c602ca327edb9ab982d7660d7c665)
@@ -0,0 +1,59 @@
+#!/bin/sh
+#
+# Pushes changes from the local GIT repository to "remote".
+# Copyright (c) Matthias Urlichs, 2005
+#
+# Takes the remote's name.
+
+name=$1
+
+die () {
+	echo gitpush.sh: $@ >&2
+	exit 1
+}
+
+
+[ "$name" ] || name=$(cat .git/tracking 2>/dev/null)
+[ "$name" ] || die "where to push to?"
+uri=$(grep $(echo -e "^$name\t" | sed 's/\./\\./g') .git/remotes | cut -f 2)
+[ "$uri" ] || die "unknown remote"
+
+
+tracking=
+[ -s .git/tracking ] && tracking=$(cat .git/tracking)
+
+orig_head=
+if [ "$tracking" = "$name" ]; then
+	[ -s .git/HEAD.tracked ] && orig_head=$(cat .git/HEAD.tracked)
+else
+	[ -s ".git/heads/$name" ] && orig_head=$(cat ".git/heads/$name")
+fi
+
+rsync $RSYNC_FLAGS -Lr "$uri/HEAD" ".git/HEAD_$name"
+$id=$(cat ".git/HEAD_$name")
+rm .git/HEAD_$name
+
+if [ -z "$id" ] ; then
+	echo "The remote system doesn't have a HEAD file: Doing an initial upload." >&2
+	echo "." >&2
+elif [ "$(cat-file -t "$id")" != "commit" ]; then
+	echo "The remote system has stuff we don't have: pull first!" >&2
+	echo "	Commit ID: $id" >&2
+	exit 1
+fi
+
+# We already saw the MOTD, thank you very much.
+rsync $RSYNC_FLAGS --ignore-existing --whole-file \
+	-v -r ".git/objects" "$uri" | grep -v '^MOTD:'
+
+# FIXME: Warn about conflicting tag names?
+rsync $RSYNC_FLAGS --ignore-existing \
+	-v -r ".git/tags" "$uri" 2>/dev/null | grep -v '^MOTD:'
+
+# Finally, update the remote HEAD
+rsync $RSYNC_FLAGS -Lr ".git/HEAD" "$uri/HEAD" \
+	2>/dev/null | grep -v '^MOTD:'
+
+echo "Now up to date."
+exit
+
-
To unsubscribe from this list: send the line "unsubscribe git" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html



